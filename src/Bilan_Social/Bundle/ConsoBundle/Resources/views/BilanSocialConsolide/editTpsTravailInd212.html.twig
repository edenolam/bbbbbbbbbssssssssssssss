
    {% if formTpsTrav212 is defined %}
        {% set bilan_social_consolide = formTpsTrav212.vars.data %}
        {{ form_start(formTpsTrav212) }}

            <table width="100%" id="ind2121Table" class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th colspan="2" rowspan="2" style="text-align: center"></th>
                        <th colspan="3" style="text-align: center">Nombre de contractuels sur emplois permanents *</th>
                        <th colspan="3" style="text-align: center">Nombre de journées d'absence</th>
                        <th colspan="3" style="text-align: center">Nombre d'arrêts**</th>
                    </tr>
                    <tr>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Total</th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Total</th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Total</th>
                    </tr>
                </thead>
                <tbody class="ind_table_totaux">

                {% for tag in formTpsTrav212.ind2121s %}
                    {% set row_data = tag.vars.value %}
                    {% set total_fonc = row_data.r21211 + row_data.r21212 %}
                    {% set total_abs = row_data.r21213 + row_data.r21214 %}
                    {% set total_arr = row_data.r21215 + row_data.r21216 %}
                    <tr idTrMa="{{tag.refMotifAbsence.vars.value}}" id="2121idMa_{{tag.refMotifAbsence.vars.value}}">
                        {% if tag.nbRowspan.vars.value != null  %}
                        <td style="min-width: 100px" rowspan="{{tag.nbRowspan.vars.value}}">
                            {% if tag.refMotifAbsence.vars.data.blAbsecomp == true %}
                                Médical compressible
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.blAbsemedi == true %}
                                Médical non compressible
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.blAbseautrrais == true %}
                                Autres raisons
                            {% endif %}
                        </td>
                        {% endif %}

                        <td style="min-width: 300px">
                            {{ form_widget(tag.refMotifAbsence) }}

                            {{ form_widget(tag.nbRowspan) }}

                            {{ tag.refMotifAbsence.vars.data.lbMotiabse}}
                        </td>

                        <td id="r21211" data-col-group='row_fonc'>
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse != 'ABS006' %}
                                {{ form_widget(tag.r21211) }}
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse == 'ABS006' %}
                                <div style="display : none">
                                {{ form_widget(tag.r21211) }}
                                </div>
                            {% endif %}
                        </td>
                        <td id="r21212" data-col-group='row_fonc'>{{ form_widget(tag.r21212) }}</td>
                        <td data-col-id='row_fonc'>{{ total_fonc }}</td>
                        <td id="r21213" data-col-group='row_abs'>
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse != 'ABS006' %}
                                {{ form_widget(tag.r21213) }}
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse == 'ABS006' %}
                                <div style="display : none">
                                {{ form_widget(tag.r21213) }}
                                </div>
                            {% endif %}
                        </td>
                        <td id="r21214" data-col-group='row_abs'>{{ form_widget(tag.r21214) }}</td>
                        <td data-col-id='row_abs'>{{ total_abs }}</td>
                        <td id="r21215" data-col-group='row_arr'>
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse != 'ABS006' and tag.refMotifAbsence.vars.data.cdMotiabse != 'ABS008'  %}
                                {{ form_widget(tag.r21215) }}
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse == 'ABS006' or tag.refMotifAbsence.vars.data.cdMotiabse == 'ABS008'  %}
                                <div style="display : none">
                                {{ form_widget(tag.r21215) }}
                                </div>
                            {% endif %}
                        </td>
                        <td id="r21216" data-col-group='row_arr'>
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse != 'ABS008'  %}
                                {{ form_widget(tag.r21216) }}
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.cdMotiabse == 'ABS008' %}
                                <div style="display : none">
                                {{ form_widget(tag.r21216) }}
                                </div>
                            {% endif %}
                        </td>
                        <td data-col-id='row_arr'>{{ total_arr }}</td>
                    </tr>

                {% endfor %}
                {% set total_row = bilan_social_consolide.getIndPileForBy('ind2121s') %}
                {% set total_row_fonc = total_row.r21211 + total_row.r21212 %}
                {% set total_row_abs  = total_row.r21213 + total_row.r21214 %}
                {% set total_row_att  = total_row.r21215 + total_row.r21216 %}
                 <tr class="filiTable row_totaux" id="total">
                    <th class="filiTable" colspan="2" style="text-align: center">Total</th>
                    <th class="filiTable" style="text-align: center" data-col-group='total_all_fonc'>{{ total_row.r21211 }}</th>
                    <th class="filiTable" style="text-align: center" data-col-group='total_all_fonc'>{{ total_row.r21212 }}</th>
                    <th class="filiTable" style="text-align: center" data-col-id='total_all_fonc'>{{ total_row_fonc }}</th>
                    <th class="filiTable" style="text-align: center" data-col-group='total_all_abs'>{{ total_row.r21213 }}</th>
                    <th class="filiTable" style="text-align: center" data-col-group='total_all_abs'>{{ total_row.r21214 }}</th>
                    <th class="filiTable" style="text-align: center" data-col-id='total_all_abs'>{{ total_row_abs }}</th>
                    <th class="filiTable" style="text-align: center" data-col-group='total_all_att'>{{ total_row.r21215 }}</th>
                    <th class="filiTable" style="text-align: center" data-col-group='total_all_att'>{{ total_row.r21216 }}</th>
                    <th class="filiTable" style="text-align: center" data-col-id='total_all_att'>{{ total_row_att }}</th>
                </tr>
                </tbody>
            </table>


            <i>
            * Si un agent a été absent sur plusieurs périodes dans l'année, ne le compter qu'une seule fois.<br/>
            ** Si un arrêt est prolongé, ne le compter qu'une seule fois.  <br/>
            <br/>
            Les congés pour couches pathologiques sont à inclure : <br/>
             (1) - en congé maternité pour les fonctionnaires<br/>
              - en congé maladie pour les contractuels.<br/>
            </i>
            <br/><br/>

            <table width="100%" id="ind2122Table" class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2" colspan="2" style="text-align: center"></th>
                        <th colspan="11" style="text-align: center">Nombre de contractuels sur emplois permanents *</th>
                    </tr>
                    <tr>
                        <th style="text-align: center">Moins de 25 ans</th>
                        <th style="text-align: center">25 ans à 29 ans</th>
                        <th style="text-align: center">30 ans à 34 ans</th>
                        <th style="text-align: center">35 ans à 39 ans</th>
                        <th style="text-align: center">40 ans à 44 ans</th>
                        <th style="text-align: center">45 ans à 49 ans</th>
                        <th style="text-align: center">50 ans à 54 ans</th>
                        <th style="text-align: center">55 ans à 59 ans</th>
                        <th style="text-align: center">60 ans à 64 ans</th>
                        <th style="text-align: center">65 ans et plus</th>
                        <th class="filiTable" style="text-align: center">Total</th>
                    </tr>
                </thead>
                <tbody>

                {% for tag in formTpsTrav212.ind2122s %}
                    <tr idTrMa="{{tag.refMotifAbsence.vars.value}}" id="2122idMa_{{tag.refMotifAbsence.vars.value}}">
                        {% if tag.nbRowspan.vars.value != null  %}
                        <td style="min-width: 100px" rowspan="{{tag.nbRowspan.vars.value}}">
                            {% if tag.refMotifAbsence.vars.data.blAbsecomp == true %}
                                Médical compressible
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.blAbsemedi == true %}
                                Médical non compressible
                            {% endif %}

                        </td>
                        {% endif %}

                        <td style="min-width: 300px">
                            {{ form_widget(tag.refMotifAbsence) }}
                            {{ form_widget(tag.nbRowspan) }}
                            {{ form_widget(tag.total2121) }}
                            {{ tag.refMotifAbsence.vars.data.lbMotiabse}}
                            <br/>
                            <span class="alerteConso">[2.1.2.1] = {{ tag.vars.value.total2121 }}</span>
                        </td>

                        <td id="r21221">{{ form_widget(tag.r21221) }}</td>
                        <td id="r21222">{{ form_widget(tag.r21222) }}</td>
                        <td id="r21223">{{ form_widget(tag.r21223) }}</td>
                        <td id="r21224">{{ form_widget(tag.r21224) }}</td>
                        <td id="r21225">{{ form_widget(tag.r21225) }}</td>
                        <td id="r21226">{{ form_widget(tag.r21226) }}</td>
                        <td id="r21227">{{ form_widget(tag.r21227) }}</td>
                        <td id="r21228">{{ form_widget(tag.r21228) }}</td>
                        <td id="r21229">{{ form_widget(tag.r21229) }}</td>
                        <td id="r212210">{{ form_widget(tag.r212210) }}</td>
                        <td class="filiTable" id="lineTot1" style="text-align: center">0</td>
                    </tr>

                {% endfor %}
                 <tr class="filiTable" id="total">
                    <th class="filiTable" colspan="2" style="text-align: center">Total</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                </tr>
                </tbody>
            </table>



            <i>* si un agent a été absent sur plusieurs périodes dans l'année, ne le compter qu'une seule fois.</i>
            <br/><br/>


            <table width="100%" id="ind2123Table" class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2" colspan="2" style="text-align: center"></th>
                        <th colspan="11" style="text-align: center">Nombre de journées d'absence</th>
                    </tr>
                    <tr>
                        <th style="text-align: center">Moins de 25 ans</th>
                        <th style="text-align: center">25 ans à 29 ans</th>
                        <th style="text-align: center">30 ans à 34 ans</th>
                        <th style="text-align: center">35 ans à 39 ans</th>
                        <th style="text-align: center">40 ans à 44 ans</th>
                        <th style="text-align: center">45 ans à 49 ans</th>
                        <th style="text-align: center">50 ans à 54 ans</th>
                        <th style="text-align: center">55 ans à 59 ans</th>
                        <th style="text-align: center">60 ans à 64 ans</th>
                        <th style="text-align: center">65 ans et plus</th>
                        <th class="filiTable" style="text-align: center">Total</th>
                    </tr>
                </thead>
                <tbody>

                {% for tag in formTpsTrav212.ind2123s %}
                    <tr idTrMa="{{tag.refMotifAbsence.vars.value}}" id="2123idMa_{{tag.refMotifAbsence.vars.value}}">
                        {% if tag.nbRowspan.vars.value != null  %}
                        <td style="min-width: 100px" rowspan="{{tag.nbRowspan.vars.value}}">
                            {% if tag.refMotifAbsence.vars.data.blAbsecomp == true %}
                                Médical compressible
                            {% endif %}
                            {% if tag.refMotifAbsence.vars.data.blAbsemedi == true %}
                                Médical non compressible
                            {% endif %}
                        </td>
                        {% endif %}

                        <td style="min-width: 300px">
                            {{ form_widget(tag.refMotifAbsence) }}
                            {{ form_widget(tag.nbRowspan) }}
                            {{ form_widget(tag.total2121) }}
                            {{ tag.refMotifAbsence.vars.data.lbMotiabse}}
                            <br/>
                            <span class="alerteConso">[2.1.2.1] = {{ tag.vars.value.total2121 }}</span>
                        </td>

                        <td id="r21231">{{ form_widget(tag.r21231) }}</td>
                        <td id="r21232">{{ form_widget(tag.r21232) }}</td>
                        <td id="r21233">{{ form_widget(tag.r21233) }}</td>
                        <td id="r21234">{{ form_widget(tag.r21234) }}</td>
                        <td id="r21235">{{ form_widget(tag.r21235) }}</td>
                        <td id="r21236">{{ form_widget(tag.r21236) }}</td>
                        <td id="r21237">{{ form_widget(tag.r21237) }}</td>
                        <td id="r21238">{{ form_widget(tag.r21238) }}</td>
                        <td id="r21239">{{ form_widget(tag.r21239) }}</td>
                        <td id="r212310">{{ form_widget(tag.r212310) }}</td>
                        <td class="filiTable" id="lineTot1" style="text-align: center">0</td>
                    </tr>

                {% endfor %}
                 <tr class="filiTable" id="total">
                    <th class="filiTable" colspan="2" style="text-align: center">Total</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                    <th class="filiTable" style="text-align: center">0</th>
                </tr>
                </tbody>
            </table>

            <br/>

            <input class="btn button-tableau pull-right" type="submit" value="Enregistrer et valider les contrôles de cohérence" name="valider" onclick="recordAuto = false;
                    $('#progImg').show();" data-valide="1" />

            <img id="progImg" src="{{ asset("img/progress.gif") }}" style="display:none"/>

        {{ form_end(formTpsTrav212) }}



        <script type="text/javascript">

        $(document).ready(function ()
        {
            changeDetect = false;
            {% if questionCollectiviteConsolide.q1 == true   %}
                $(document).change();
                // update2121();
                update2122();
                update2123();

            {% endif %}
        });

        function changedR2121(obj) {
            // update2121();
        }

        function changedR2122(obj) {
            update2122();
        }

        function changedR2123(obj) {
            update2123();
        }

        function update2121(){
            var table2121 = document.getElementById('ind2121Table');

            var rowLength2121 = table2121.rows.length;
            var idxRowInput = 0;
            var mtTot1 = 0;
            var mtTot2 = 0;
            var mtTot3 = 0;
            var mtTot4 = 0;
            var mtTot5 = 0;
            var mtTot6 = 0;

            for(var i=2; i<rowLength2121; i+=1){
                // contenu de la ligne entière
                var row = table2121.rows[i];
                // nombre de cellule sur la ligne
                var cellLength = row.cells.length;

                var lineTotal = false;

                if(row.id.substring(0, 5)=="total") {
                    lineTotal = true;

                    for(var y=0; y<cellLength; y+=1){
                        var cell = row.cells[y];
                        if(y==1) {
                            cell.innerHTML = mtTot1;
                            mtTot1 = 0;
                        }
                        else if(y==2) {
                            cell.innerHTML = mtTot2;
                            mtTot2 = 0;
                        }
                        else if(y==3) {
                            cell.innerHTML = mtTot3;
                            mtTot3 = 0;
                        }
                        else if(y==4) {
                            cell.innerHTML = mtTot4;
                            mtTot4 = 0;
                        }
                        else if(y==5) {
                            cell.innerHTML = mtTot5;
                            mtTot5 = 0;
                        }
                        else if(y==6) {
                            cell.innerHTML = mtTot6;
                            mtTot6 = 0;
                        }

                    }
                }

                for(var y=0; y<cellLength; y+=1){
                    var cell = row.cells[y];
                    if(cell.id.substring(0, 6)=="r21211") {
                        if($('#bscForm212_ind2121s_'+idxRowInput+'_r21211').val()!="") {
                            mtTot1 += parseInt($('#bscForm212_ind2121s_'+idxRowInput+'_r21211').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21212") {
                        if($('#bscForm212_ind2121s_'+idxRowInput+'_r21212').val()!="") {
                            mtTot2 += parseInt($('#bscForm212_ind2121s_'+idxRowInput+'_r21212').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21213") {
                        if($('#bscForm212_ind2121s_'+idxRowInput+'_r21213').val()!="") {
                            mtTot3 += parseFloat($('#bscForm212_ind2121s_'+idxRowInput+'_r21213').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21214") {
                        if($('#bscForm212_ind2121s_'+idxRowInput+'_r21214').val()!="") {
                            mtTot4 += parseFloat($('#bscForm212_ind2121s_'+idxRowInput+'_r21214').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21215") {
                        if($('#bscForm212_ind2121s_'+idxRowInput+'_r21215').val()!="") {
                            mtTot5 += parseInt($('#bscForm212_ind2121s_'+idxRowInput+'_r21215').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21216") {
                        if($('#bscForm212_ind2121s_'+idxRowInput+'_r21216').val()!="") {
                            mtTot6 += parseInt($('#bscForm212_ind2121s_'+idxRowInput+'_r21216').val());
                        }
                    }

                }

                if(!lineTotal) idxRowInput++;
            }
        }


        function update2122(){
            var table2122 = document.getElementById('ind2122Table');

            var rowLength2122 = table2122.rows.length;
            var idxRowInput = 0;
            var mtTot1 = 0;
            var mtTot2 = 0;
            var mtTot3 = 0;
            var mtTot4 = 0;
            var mtTot5 = 0;
            var mtTot6 = 0;
            var mtTot7 = 0;
            var mtTot8 = 0;
            var mtTot9 = 0;
            var mtTot10 = 0;

            for(var i=2; i<rowLength2122; i+=1){
                // contenu de la ligne entière
                var row = table2122.rows[i];
                // nombre de cellule sur la ligne
                var cellLength = row.cells.length;

                var lineTotal = false;
                var lineTot1 = 0;

                if(row.id.substring(0, 5)=="total") {
                    lineTotal = true;

                    for(var y=0; y<cellLength; y+=1){
                        var cell = row.cells[y];
                        if(y==1) {
                            cell.innerHTML = mtTot1;
                            lineTot1 += mtTot1;
                            mtTot1 = 0;
                        }
                        else if(y==2) {
                            cell.innerHTML = mtTot2;
                            lineTot1 += mtTot2;
                            mtTot2 = 0;
                        }
                        else if(y==3) {
                            cell.innerHTML = mtTot3;
                            lineTot1 += mtTot3;
                            mtTot3 = 0;
                        }
                        else if(y==4) {
                            cell.innerHTML = mtTot4;
                            lineTot1 += mtTot4;
                            mtTot4 = 0;
                        }
                        else if(y==5) {
                            cell.innerHTML = mtTot5;
                            lineTot1 += mtTot5;
                            mtTot5 = 0;
                        }
                        else if(y==6) {
                            cell.innerHTML = mtTot6;
                            lineTot1 += mtTot6;
                            mtTot6 = 0;
                        }
                        else if(y==7) {
                            cell.innerHTML = mtTot7;
                            lineTot1 += mtTot7;
                            mtTot7 = 0;
                        }
                        else if(y==8) {
                            cell.innerHTML = mtTot8;
                            lineTot1 += mtTot8;
                            mtTot8 = 0;
                        }
                        else if(y==9) {
                            cell.innerHTML = mtTot9;
                            lineTot1 += mtTot9;
                            mtTot9 = 0;
                        }
                        else if(y==10) {
                            cell.innerHTML = mtTot10;
                            lineTot1 += mtTot10;
                            mtTot10 = 0;
                        }
                        else if (y == 11) {
                            cell.innerHTML = lineTot1;
                        }
                    }
                }

                lineTot1 = 0;

                for(var y=0; y<cellLength; y+=1){
                    var cell = row.cells[y];

                    if(cell.id.substring(0, 6)=="r21222") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21222').val()!="") {
                            mtTot2 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21222').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21222').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21223") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21223').val()!="") {
                            mtTot3 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21223').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21223').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21224") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21224').val()!="") {
                            mtTot4 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21224').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21224').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21225") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21225').val()!="") {
                            mtTot5 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21225').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21225').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21226") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21226').val()!="") {
                            mtTot6 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21226').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21226').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21227") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21227').val()!="") {
                            mtTot7 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21227').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21227').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21228") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21228').val()!="") {
                            mtTot8 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21228').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21228').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21229") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21229').val()!="") {
                            mtTot9 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21229').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21229').val());
                        }
                    }
                    else if(cell.id.substring(0, 7)=="r212210") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r212210').val()!="") {
                            mtTot10 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r212210').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r212210').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21221") {
                        if($('#bscForm212_ind2122s_'+idxRowInput+'_r21221').val()!="") {
                            mtTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21221').val());
                            lineTot1 += parseInt($('#bscForm212_ind2122s_'+idxRowInput+'_r21221').val());
                        }
                    } else if (cell.id.substring(0, 8) == "lineTot1") {
                        cell.innerHTML = lineTot1;
                    }
                }

                if(!lineTotal) idxRowInput++;
            }
        }


        function update2123(){
            var table2123 = document.getElementById('ind2123Table');

            var rowLength2123 = table2123.rows.length;
            var idxRowInput = 0;
            var mtTot1 = 0;
            var mtTot2 = 0;
            var mtTot3 = 0;
            var mtTot4 = 0;
            var mtTot5 = 0;
            var mtTot6 = 0;
            var mtTot7 = 0;
            var mtTot8 = 0;
            var mtTot9 = 0;
            var mtTot10 = 0;

            for(var i=2; i<rowLength2123; i+=1){
                // contenu de la ligne entière
                var row = table2123.rows[i];
                // nombre de cellule sur la ligne
                var cellLength = row.cells.length;

                var lineTotal = false;
                var lineTot1 = 0;

                if(row.id.substring(0, 5)=="total") {
                    lineTotal = true;

                    for(var y=0; y<cellLength; y+=1){
                        var cell = row.cells[y];
                        if(y==1) {
                            cell.innerHTML = mtTot1;
                            lineTot1 += mtTot1;
                            mtTot1 = 0;
                        }
                        else if(y==2) {
                            cell.innerHTML = mtTot2;
                            lineTot1 += mtTot2;
                            mtTot2 = 0;
                        }
                        else if(y==3) {
                            cell.innerHTML = mtTot3;
                            lineTot1 += mtTot3;
                            mtTot3 = 0;
                        }
                        else if(y==4) {
                            cell.innerHTML = mtTot4;
                            lineTot1 += mtTot4;
                            mtTot4 = 0;
                        }
                        else if(y==5) {
                            cell.innerHTML = mtTot5;
                            lineTot1 += mtTot5;
                            mtTot5 = 0;
                        }
                        else if(y==6) {
                            cell.innerHTML = mtTot6;
                            lineTot1 += mtTot6;
                            mtTot6 = 0;
                        }
                        else if(y==7) {
                            cell.innerHTML = mtTot7;
                            lineTot1 += mtTot7;
                            mtTot7 = 0;
                        }
                        else if(y==8) {
                            cell.innerHTML = mtTot8;
                            lineTot1 += mtTot8;
                            mtTot8 = 0;
                        }
                        else if(y==9) {
                            cell.innerHTML = mtTot9;
                            lineTot1 += mtTot9;
                            mtTot9 = 0;
                        }
                        else if(y==10) {
                            cell.innerHTML = mtTot10;
                            lineTot1 += mtTot10;
                            mtTot10 = 0;
                        } else if (y == 11) {
                            cell.innerHTML = lineTot1;
                        }

                    }
                }

                lineTot1 = 0;

                for(var y=0; y<cellLength; y+=1){
                    var cell = row.cells[y];

                    if(cell.id.substring(0, 6)=="r21232") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21232').val()!="") {
                            mtTot2 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21232').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21232').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21233") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21233').val()!="") {
                            mtTot3 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21233').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21233').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21234") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21234').val()!="") {
                            mtTot4 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21234').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21234').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21235") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21235').val()!="") {
                            mtTot5 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21235').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21235').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21236") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21236').val()!="") {
                            mtTot6 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21236').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21236').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21237") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21237').val()!="") {
                            mtTot7 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21237').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21237').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21238") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21238').val()!="") {
                            mtTot8 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21238').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21238').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21239") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21239').val()!="") {
                            mtTot9 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21239').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21239').val());
                        }
                    }
                    else if(cell.id.substring(0, 7)=="r212310") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r212310').val()!="") {
                            mtTot10 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r212310').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r212310').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r21231") {
                        if($('#bscForm212_ind2123s_'+idxRowInput+'_r21231').val()!="") {
                            mtTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21231').val());
                            lineTot1 += parseFloat($('#bscForm212_ind2123s_'+idxRowInput+'_r21231').val());
                        }
                    } else if (cell.id.substring(0, 8) == "lineTot1") {
                        cell.innerHTML = lineTot1;
                    }

                }

                if(!lineTotal) idxRowInput++;
            }
        }



        /*
         * METHODE AJAX SUBMIT
         */
        $(function () {
            // Enregistrement en ajax
            $('form').on('submit', function (e) {
                var $this = $(this).closest('div');
                var btn = $(this).find("input[type=submit]:focus");
                var value_valide = $(btn).data('valide');
                $('#bscForm212_valide').val(value_valide);
                // Submit en ajax pour le fonctionnement d'appel par onglet
                e.preventDefault();

                $.ajax({
                    type: 'post',
                    url: '{{ path('bilan_conso_tpstrav_ind212_edit') }}',
                    data: $('form').serialize(),
                    success: function (responsejson) {

                        if (responsejson.data == 1) {
                            if (recordAuto) {
                                $('#progImg').hide();
                                $('#messageJS').html("Enregistrement automatique réussi");
                                messageJS.dialog("open");
                                setIncoherenceTable(responsejson);
                            } else {
                                $('#ind212').load('{{ path('bilan_conso_tpstrav_ind212_edit') }}', function () {
                                    $('#progImg').hide();
                                    $('#messageJS').html("Enregistrement réussi");
                                    messageJS.dialog("open");
                                    setIncoherenceTable(responsejson);

                                    var next = $($this).next('.panel-heading');
                                    if(next.length == 0) {
                                        window.location.href = '{{ path('bilan_conso_remuneration_edit') }}';
                                    }
                                });

                            }
                        } else if (responsejson.data == "-3") {
                            $('#progImg').hide();
                            $('#messageJS').html("{{'erreur.unique.violation'|trans}}");
                            messageJS.dialog("open");
                        } else {
                            $('#progImg').hide();
                            $('#messageJS').html("Une erreur s'est produite dans l'enregistrement 1");
                            messageJS.dialog("open");
                        }


                    },
                    error: function (xhr, status, error) {
                        //alert(xhr);
                        $('#progImg').hide();
                        $('#messageJS').html("Une erreur s'est produite dans l'enregistrement 2 ");
                        messageJS.dialog("open");
                    }

                });

            });

        });

        </script>
    {% endif %}


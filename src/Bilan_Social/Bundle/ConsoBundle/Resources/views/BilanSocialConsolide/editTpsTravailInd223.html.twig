{% set campagne = campagne_service.GetCurrentCampagne() %}
    {% set AnneeCamp = '' %}
    {% if campagne is not null %}
        {% set AnneeCamp = campagne.nmAnne %}
    {% endif %}

    {% if formTpsTrav223 is defined %}

        {{ form_start(formTpsTrav223) }}

            <h5>
               Champ : le tableau qui suit concerne les agents présents dans la collectivité locale au 31/12/{{AnneeCamp}}
            </h5>

            <table width="100%" id="ind2231Table" class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th style="text-align: center">2.2.3.1 Nombre d'agents ayant un compte épargne temps (CET)</th>
                        <th colspan="2" style="text-align: center">Nombre d'agents ayant un compte épargne temps (CET) au 31/12/{{AnneeCamp}}</th>
                        <th colspan="2" style="text-align: center">dont Nombre d'agents ayant ouvert un compte épargne temps (CET) en {{AnneeCamp}}</th>
                        <th style="text-align: center" class="filiTable">Nombre total d'agents ayant un compte épargne temps (CET) au 31/12/{{AnneeCamp}}</th>
                        <th style="text-align: center" class="filiTable">dont Nombre d'agents ayant ouvert un compte épargne temps (CET) en {{AnneeCamp}}</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Total</th>
                        <th style="text-align: center">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tag in formTpsTrav223.ind2231s %}
                        <tr  id="2231tr_{{tag.refCategorie.vars.value}}">
                            <td style="min-width: 400px">{{ form_widget(tag.refCategorie) }}
                                Catégorie {{ tag.refCategorie.vars.data.lbCate }}
                            </td>
                            <td id="r22311" style="text-align: center">{{ form_widget(tag.r22311) }}</td>
                            <td id="r22312" style="text-align: center">{{ form_widget(tag.r22312) }}</td>
                            <td id="r22313" style="text-align: center">{{ form_widget(tag.r22313) }}</td>
                            <td id="r22314" style="text-align: center">{{ form_widget(tag.r22314) }}</td>
                            <td id="lineTot1" style="text-align: center" class="filiTable">0</td>
                            <td id="lineTot2" style="text-align: center" class="filiTable">0</td>
                        </tr>
                    {% endfor %}

                    {% if formTpsTrav223.ind2231s.count() > 0  %}
                        <tr id="total2231" class="filiTable">
                            <td style="min-width: 400px"><b>Toutes catégories</b></td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>

                        </tr>
                    {% endif %}
                </tbody>
            </table>

            <br/>

            <h5>
               Champ : le tableau qui suit concerne les agents présents dans la collectivité locale au 31/12/{{AnneeCamp}}
            </h5>

            <table width="100%" id="ind2232Table" class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th style="text-align: center">2.2.3.2 Nombre de jours accumulés</th>
                        <th colspan="2" style="text-align: center">Nombre de jours accumulés au 31/12/{{AnneeCamp}}</th>
                        <th colspan="2" style="text-align: center">dont Nombre de jours versés au titre de l'année {{AnneeCamp}}</th>
                        <th style="text-align: center" class="filiTable">Nombre de jours accumulés au 31/12/{{AnneeCamp}}</th>
                        <th style="text-align: center" class="filiTable">dont Nombre de jours versés au titre de l'année {{AnneeCamp}}</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Total</th>
                        <th style="text-align: center">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tag in formTpsTrav223.ind2232s %}
                        <tr>
                            <td style="min-width: 400px">{{ form_widget(tag.refCategorie) }}
                                Catégorie {{ tag.refCategorie.vars.data.lbCate }}
                            </td>
                            <td id="r22321" style="text-align: center">{{ form_widget(tag.r22321) }}</td>
                            <td id="r22322" style="text-align: center">{{ form_widget(tag.r22322) }}</td>
                            <td id="r22323" style="text-align: center">{{ form_widget(tag.r22323) }}</td>
                            <td id="r22324" style="text-align: center">{{ form_widget(tag.r22324) }}</td>
                            <td id="lineTot1" style="text-align: center" class="filiTable">0</td>
                            <td id="lineTot2" style="text-align: center" class="filiTable">0</td>
                        </tr>
                    {% endfor %}

                    {% if formTpsTrav223.ind2232s.count() > 0  %}
                        <tr id="total2232" class="filiTable">
                            <td style="min-width: 400px"><b>Toutes catégories</b></td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>
                            <td style="text-align: center">0</td>

                        </tr>
                    {% endif %}
                </tbody>
            </table>

            <br />

            <h5>
               Champ : le tableau qui suit concerne tous les agents étant passés par la collectivité locale même s'ils n'y sont plus au 31/12/{{AnneeCamp}}
            </h5>

            <table width="100%" id="ind2233Table" class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th style="text-align: center">2.2.3.3 Nombre de jours utilisés par type de consommation (cf. décret n° 2010-531 du 20 mai 2010)</th>
                        <th colspan="2" style="text-align: center">Nombre de jours utilisés sous forme de congés au 31/12/{{AnneeCamp}} </th>
                        <th colspan="2" style="text-align: center">Nombre de jours indemnisés en {{AnneeCamp}} </th>
                        <th colspan="2" style="text-align: center">Nombre de jours pris en compte au titre de la Rafp* en {{AnneeCamp}}</th>
                        <th colspan="2" style="text-align: center">Nombre de jours donnés au bénéfice de proches</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                        <th style="text-align: center">Hommes</th>
                        <th style="text-align: center">Femmes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tag in formTpsTrav223.ind2233s %}
                        <tr>
                            <td style="min-width: 400px">{{ form_widget(tag.refCategorie) }}
                                Catégorie {{ tag.refCategorie.vars.data.lbCate }}
                            </td>
                            <td id="r22331" style="text-align: center">{{ form_widget(tag.r22331) }}</td>
                            <td id="r22332" style="text-align: center">{{ form_widget(tag.r22332) }}</td>
                            <td id="r22333" style="text-align: center">{{ form_widget(tag.r22333) }}</td>
                            <td id="r22334" style="text-align: center">{{ form_widget(tag.r22334) }}</td>
                            <td id="r22335" style="text-align: center">{{ form_widget(tag.r22335) }}</td>
                            <td id="r22336" style="text-align: center">{{ form_widget(tag.r22336) }}</td>
                            <td id="r22337" style="text-align: center">{{ form_widget(tag.r22337) }}</td>
                            <td id="r22338" style="text-align: center">{{ form_widget(tag.r22338) }}</td>
                        </tr>
                    {% endfor %}

                    {% if formTpsTrav223.ind2233s.count() > 0  %}
                        <tr id="total2233" class="filiTable">
                            <td class="positiveFloat010Rounded" style="min-width: 400px"><b>Toutes catégories</b></td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>
                            <td class="positiveFloat010Rounded" style="text-align: center">0</td>

                        </tr>
                    {% endif %}
                </tbody>
            </table>

            *Régime de retraite additionnel dans la fonction publique (Rafp).

            <input class="btn button-tableau pull-right" type="submit" value="Enregistrer et valider les contrôles de cohérence" name="valider" onclick="recordAuto = false;
                    $('#progImg').show();" data-valide="1" />

            <img id="progImg" src="{{ asset("img/progress.gif") }}" style="display:none"/>

        {{ form_end(formTpsTrav223) }}



        <script type="text/javascript">

        $(document).ready(function ()
        {
            changeDetect = false;
            {% if questionCollectiviteConsolide.q2 == true or questionCollectiviteConsolide.q4 == true   %}
                $(document).change();
                update2231();
                update2232();
                update2233();

            {% endif %}
        });

        function changedR2231(obj) {
            update2231();
        }

        function changedR2232(obj) {
            update2232();
        }

        function changedR2233(obj) {
            update2233();
        }

        function update2231(){
            var table2231 = document.getElementById('ind2231Table');

            var rowLength2231 = table2231.rows.length;
            var idxRowInput = 0;
            var mtTot1 = 0;
            var mtTot2 = 0;
            var mtTot3 = 0;
            var mtTot4 = 0;

            for(var i=2; i<rowLength2231; i+=1){
                // contenu de la ligne entière
                var row = table2231.rows[i];
                // nombre de cellule sur la ligne
                var cellLength = row.cells.length;

                var lineTotal = false;
                var lineTot1 = 0;
                var lineTot2 = 0;

                if(row.id.substring(0, 5)=="total") {
                    lineTotal = true;

                    for(var y=0; y<cellLength; y+=1){
                        var cell = row.cells[y];
                        if(y==1) {
                            cell.innerHTML = mtTot1;
                            lineTot1 += mtTot1;
                            mtTot1 = 0;
                        }
                        else if(y==2) {
                            cell.innerHTML = mtTot2;
                            lineTot1 += mtTot2;
                            mtTot2 = 0;
                        }
                        else if(y==3) {
                            cell.innerHTML = mtTot3;
                            lineTot2 += mtTot3;
                            mtTot3 = 0;
                        }
                        else if(y==4) {
                            cell.innerHTML = mtTot4;
                            lineTot2 += mtTot4;
                            mtTot4 = 0;
                        }
                        else if (y == 5) {
                            cell.innerHTML = lineTot1;
                        }
                        else if (y == 6) {
                            cell.innerHTML = lineTot2;
                        }
                    }
                }

                lineTot1 = 0;

                for(var y=0; y<cellLength; y+=1){
                    var cell = row.cells[y];

                    if(cell.id.substring(0, 6)=="r22311") {
                        if($('#bscForm223_ind2231s_'+idxRowInput+'_r22311').val()!="") {
                            mtTot1 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22311').val());
                            lineTot1 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22311').val());                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22312") {
                        if($('#bscForm223_ind2231s_'+idxRowInput+'_r22312').val()!="") {
                            mtTot2 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22312').val());
                            lineTot1 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22312').val());                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22313") {
                        if($('#bscForm223_ind2231s_'+idxRowInput+'_r22313').val()!="") {
                            mtTot3 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22313').val());
                            lineTot2 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22313').val());
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22314") {
                        if($('#bscForm223_ind2231s_'+idxRowInput+'_r22314').val()!="") {
                            mtTot4 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22314').val());
                            lineTot2 += parseInt($('#bscForm223_ind2231s_'+idxRowInput+'_r22314').val());
                        }
                    } else if (cell.id.substring(0, 8) == "lineTot1") {
                        cell.innerHTML = lineTot1;
                    } else if (cell.id.substring(0, 8) == "lineTot2") {
                        cell.innerHTML = lineTot2;
                    }
                }

                if(!lineTotal) idxRowInput++;
            }
        }


        function update2232(){
            var table2232 = document.getElementById('ind2232Table');

            var rowLength2232 = table2232.rows.length;
            var idxRowInput = 0;
            var mtTot1 = 0;
            var mtTot2 = 0;
            var mtTot3 = 0;
            var mtTot4 = 0;

            for(var i=2; i<rowLength2232; i+=1){
                // contenu de la ligne entière
                var row = table2232.rows[i];
                // nombre de cellule sur la ligne
                var cellLength = row.cells.length;

                var lineTotal = false;
                var lineTot1 = 0;
                var lineTot2 = 0;

                if(row.id.substring(0, 5)=="total") {
                    lineTotal = true;

                    for(var y=0; y<cellLength; y+=1){
                        var cell = row.cells[y];
                        if(y==1) {
                            cell.innerHTML = round(parseFloat(mtTot1),1);
                            lineTot1 += round(parseFloat(mtTot1),1);
                            mtTot1 = 0;
                        }
                        else if(y==2) {
                            cell.innerHTML = round(parseFloat(mtTot2),1);
                            lineTot1 += round(parseFloat(mtTot2),1);
                            mtTot2 = 0;
                        }
                        else if(y==3) {
                            cell.innerHTML = round(parseFloat(mtTot3),1);
                            lineTot2 += round(parseFloat(mtTot3),1);
                            mtTot3 = 0;
                        }
                        else if(y==4) {
                            cell.innerHTML = round(parseFloat(mtTot4),1);
                            lineTot2 += round(parseFloat(mtTot4),1);
                            mtTot4 = 0;
                        }
                        else if (y == 5) {
                            cell.innerHTML = round(parseFloat(lineTot1),1);
                        }
                        else if (y == 6) {
                            cell.innerHTML = round(parseFloat(lineTot2),1);
                        }
                    }
                }

                lineTot1 = 0;

                for(var y=0; y<cellLength; y+=1){
                    var cell = row.cells[y];

                    if(cell.id.substring(0, 6)=="r22321") {
                        if($('#bscForm223_ind2232s_'+idxRowInput+'_r22321').val()!="") {
                            mtTot1 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22321').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22321').val()),1);    }
                    }
                    else if(cell.id.substring(0, 6)=="r22322") {
                        if($('#bscForm223_ind2232s_'+idxRowInput+'_r22322').val()!="") {
                            mtTot2 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22322').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22322').val()),1);                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22323") {
                        if($('#bscForm223_ind2232s_'+idxRowInput+'_r22323').val()!="") {
                            mtTot3 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22323').val()),1);
                            lineTot2 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22323').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22324") {
                        if($('#bscForm223_ind2232s_'+idxRowInput+'_r22324').val()!="") {
                            mtTot4 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22324').val()),1);
                            lineTot2 += round(parseFloat($('#bscForm223_ind2232s_'+idxRowInput+'_r22324').val()),1);
                        }
                    } else if (cell.id.substring(0, 8) == "lineTot1") {
                        cell.innerHTML = round(parseFloat(lineTot1),1);
                    } else if (cell.id.substring(0, 8) == "lineTot2") {
                        cell.innerHTML = round(parseFloat(lineTot2),1);
                    }
                }

                if(!lineTotal) idxRowInput++;
            }
        }


        function update2233(){
            var table2233 = document.getElementById('ind2233Table');

            var rowLength2233 = table2233.rows.length;
            var idxRowInput = 0;
            var mtTot1 = 0;
            var mtTot2 = 0;
            var mtTot3 = 0;
            var mtTot4 = 0;
            var mtTot5 = 0;
            var mtTot6 = 0;
            var mtTot7 = 0;
            var mtTot8 = 0;
            var mtTot9 = 0;
            var mtTot10 = 0;

            for(var i=2; i<rowLength2233; i+=1){
                // contenu de la ligne entière
                var row = table2233.rows[i];
                // nombre de cellule sur la ligne
                var cellLength = row.cells.length;

                var lineTotal = false;
                var lineTot1 = 0;

                if(row.id.substring(0, 5)=="total") {
                    lineTotal = true;

                    for(var y=0; y<cellLength; y+=1){
                        var cell = row.cells[y];
                        if(y==1) {
                            cell.innerHTML = round(parseFloat(mtTot1),1);
                            lineTot1 += round(parseFloat(mtTot1),1);
                            mtTot1 = 0;
                        }
                        else if(y==2) {
                            cell.innerHTML = round(parseFloat(mtTot2),1);
                            lineTot1 += round(parseFloat(mtTot2),1);
                            mtTot2 = 0;
                        }
                        else if(y==3) {
                            cell.innerHTML = round(parseFloat(mtTot3),1);
                            lineTot1 += round(parseFloat(mtTot3),1);
                            mtTot3 = 0;
                        }
                        else if(y==4) {
                            cell.innerHTML = round(parseFloat(mtTot4),1);
                            lineTot1 += round(parseFloat(mtTot4),1);
                            mtTot4 = 0;
                        }
                        else if(y==5) {
                            cell.innerHTML = round(parseFloat(mtTot5),1);
                            lineTot1 += round(parseFloat(mtTot5),1);
                            mtTot5 = 0;
                        }
                        else if(y==6) {
                            cell.innerHTML = round(parseFloat(mtTot6),1);
                            lineTot1 += round(parseFloat(mtTot6),1);
                            mtTot6 = 0;
                        }
                        else if(y==7) {
                            cell.innerHTML = round(parseFloat(mtTot7),1);
                            lineTot1 += round(parseFloat(mtTot7),1);
                            mtTot7 = 0;
                        }
                        else if(y==8) {
                            cell.innerHTML = round(parseFloat(mtTot8),1);
                            lineTot1 += round(parseFloat(mtTot8),1);
                            mtTot8 = 0;
                        }
                        else if(y==9) {
                            cell.innerHTML = round(parseFloat(mtTot9),1);
                            lineTot1 += round(parseFloat(mtTot9),1);
                            mtTot9 = 0;
                        }
                        else if(y==10) {
                            cell.innerHTML = round(parseFloat(mtTot10),1);
                            lineTot1 += round(parseFloat(mtTot10),1);
                            mtTot10 = 0;
                        } else if (y == 11) {
                            cell.innerHTML = round(parseFloat(lineTot1),1);
                        }

                    }
                }

                lineTot1 = 0;

                for(var y=0; y<cellLength; y+=1){
                    var cell = row.cells[y];

                    if(cell.id.substring(0, 6)=="r22332") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22332').val()!="") {
                            mtTot2 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22332').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22332').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22333") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22333').val()!="") {
                            mtTot3 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22333').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22333').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22334") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22334').val()!="") {
                            mtTot4 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22334').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22334').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22335") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22335').val()!="") {
                            mtTot5 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22335').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22335').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22336") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22336').val()!="") {
                            mtTot6 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22336').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22336').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22337") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22337').val()!="") {
                            mtTot7 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22337').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22337').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22338") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22338').val()!="") {
                            mtTot8 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22338').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22338').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22339") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22339').val()!="") {
                            mtTot9 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22339').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22339').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 7)=="r223310") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r223310').val()!="") {
                            mtTot10 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r223310').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r223310').val()),1);
                        }
                    }
                    else if(cell.id.substring(0, 6)=="r22331") {
                        if($('#bscForm223_ind2233s_'+idxRowInput+'_r22331').val()!="") {
                            mtTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22331').val()),1);
                            lineTot1 += round(parseFloat($('#bscForm223_ind2233s_'+idxRowInput+'_r22331').val()),1);
                        }
                    } else if (cell.id.substring(0, 8) == "lineTot1") {
                        cell.innerHTML = round(parseFloat(lineTot1),1);
                    }

                }

                if(!lineTotal) idxRowInput++;
            }
        }
        
        function round(value, precision) {
            var multiplier = Math.pow(10, precision || 0);
            return Math.round(value * multiplier) / multiplier;
        }



        /*
         * METHODE AJAX SUBMIT
         */
        $(function () {
            // Enregistrement en ajax
            $('form').on('submit', function (e) {
                var $this = $(this).closest('div');
                var btn = $(this).find("input[type=submit]:focus");
                var value_valide = $(btn).data('valide');
                $('#bscForm223_valide').val(value_valide);
                // Submit en ajax pour le fonctionnement d'appel par onglet
                e.preventDefault();

                $.ajax({
                    type: 'post',
                    url: '{{ path('bilan_conso_tpstrav_ind223_edit') }}',
                    data: $('form').serialize(),
                    success: function (responsejson) {

                        if (responsejson.data == 1) {
                            if (recordAuto) {
                                $('#progImg').hide();
                                $('#messageJS').html("Enregistrement automatique réussi");
                                messageJS.dialog("open");
                                setIncoherenceTable(responsejson);
                            } else {
                                $('#ind223').load('{{ path('bilan_conso_tpstrav_ind223_edit') }}', function () {
                                    $('#progImg').hide();
                                    $('#messageJS').html("Enregistrement réussi");
                                    messageJS.dialog("open");
                                    setIncoherenceTable(responsejson);

                                    var next = $($this).next('.panel-heading');
                                    if(next.length == 0) {
                                        window.location.href = '{{ path('bilan_conso_remuneration_edit') }}';
                                    }
                                });

                            }
                        } else if (responsejson.data == "-3") {
                            $('#progImg').hide();
                            $('#messageJS').html("{{'erreur.unique.violation'|trans}}");
                            messageJS.dialog("open");
                        } else {
                            $('#progImg').hide();
                            $('#messageJS').html("Une erreur s'est produite dans l'enregistrement 1");
                            messageJS.dialog("open");
                        }


                    },
                    error: function (xhr, status, error) {
                        //alert(xhr);
                        $('#progImg').hide();
                        $('#messageJS').html("Une erreur s'est produite dans l'enregistrement 2 ");
                        messageJS.dialog("open");
                    }

                });

            });

        });

        </script>
    {% endif %}




{% if formEffectif122 is defined %}
    {% set bilan_social_consolide = formEffectif122.vars.data %}
    {{ form_start(formEffectif122) }}
    <h5>
        Champ : le tableau qui suit concerne les agents contractuels sur un emploi permanent
        Remarque importante : les agents occupant un emploi fonctionnel doivent être uniquement comptabilisés dans leurs cadres d'emplois et grades respectifs.
    </h5>

    <table width="100%" id="ind122Table" class="table table-striped table-hover table-bordered">
        <thead>
        <tr entete="1">
            <th rowspan="4"></th>
            <th colspan="10" style="text-align: center">CONTRACTUELS sur emplois permanents occupant un poste
                à TEMPS COMPLET et exerçant leurs fonctions à :</th>
            <th class="filiTable" rowspan="4"  style="text-align: center">Total temps plein + temps partiel</th>

            <th rowspan="3" colspan="2" style="text-align: center">Total</th>
            <th class="filiTable" rowspan="4" style="text-align: center">Total hommes + femmes</th>
        </tr>
        <tr entete="1">
            <th colspan="3" style="text-align: center">TEMPS PLEIN</th>
            <th colspan="7" style="text-align: center">Tout type de TEMPS PARTIEL (sauf thérapeutique)</th>
        </tr>
        <tr entete="1">
            <th colspan="2" style="text-align: center">100%</th>
            <th class="filiTable" rowspan="2" style="text-align: center">Total temps plein</th>
            <th colspan="2" style="text-align: center">Moins de 80%	</th>
            <th colspan="2" style="text-align: center"> de 80% à moins de 90%</th>
            <th colspan="2" style="text-align: center">90% et plus</th>
            <th class="filiTable" rowspan="2"  style="text-align: center">Total temps partiel</th>
        </tr>
        <tr entete="1">
            <th style="text-align: center">Hommes <br/>1.2.2(1)</th>
            <th style="text-align: center">Femmes <br/>1.2.2(2)</th>
            <th style="text-align: center">Hommes <br/>1.2.2(3)</th>
            <th style="text-align: center">Femmes <br/>1.2.2(4)</th>
            <th style="text-align: center">Hommes <br/>1.2.2(5)</th>
            <th style="text-align: center">Femmes <br/>1.2.2(6)</th>
            <th style="text-align: center">Hommes <br/>1.2.2(7)</th>
            <th style="text-align: center">Femmes <br/>1.2.2(8)</th>

            <th style="text-align: center">Hommes</th>
            <th style="text-align: center">Femmes</th>
        </tr>

        </thead>
        <tbody class="ind_table_totaux">
        {% for tagF in filieres %}


            <tr id="entetFil" hide="1" idFili="{{ tagF.idFili }}" cdFili="{{ tagF.cdFili }}" style="text-align: center">
                <td colspan="18">
                    &nbsp;&nbsp;&nbsp;&nbsp;{{ tagF.lbFili }}
                    {% for key,tot in arrayTotalFiliere %}
                        {% if(key == tagF.idFili) %}
                            <span class="alerteConso">[{% if(tot) == null %} 0 {% else %} {{ tot }} {% endif %}]</span>
                        {% endif %}
                    {% endfor %}
                    {% if idFili == tagF.idFili%}
                        <input class="buttonmoins" type="button" id="toggle122_{{ tagF.idFili}}"
                               onclick="toggleFiliere122(this, {{ tagF.idFili}})">
                    {% endif%}

                    {% if idFili != tagF.idFili%}
                        <input class="buttonplus" type="button" id="toggle122_{{ tagF.idFili}}"
                               onclick="toggleFiliere122(this, {{ tagF.idFili}})">
                    {% endif%}
                </td>
            </tr>

            {% if idFili == tagF.idFili%}
                {% for tag in formEffectif122.ind122sTemp %}
                    {% set row_data = tag.vars.value %}
                    {% set total_row_h = row_data.r1221 + row_data.r1223 + row_data.r1225 + row_data.r1227 %}
                    {% set total_row_f = row_data.r1222 + row_data.r1224 + row_data.r1226 + row_data.r1228 %}
                    {% set total_row_tp = row_data.r1221 + row_data.r1222 %}
                    {% set total_row_tpa = row_data.r1223 + row_data.r1224 + row_data.r1225 + row_data.r1226 + row_data.r1227 + row_data.r1228 %}
                    <tr cdFili="{{ tag.cdFili.vars.value }}"
                        id="122trCE_{{tag.refCadreEmploi.vars.value}}"
                        idTrFili="{{ tag.idFili.vars.value }}"
                        idTrCate="{{ tag.idCate.vars.value }}">
                        <td>
                            {{ form_widget(tag.refCadreEmploi) }}
                            {{ form_widget(tag.idFili) }}
                            {{ form_widget(tag.cdFili) }}
                            {{ form_widget(tag.lbFili) }}
                            {{ form_widget(tag.newFiliere) }}
                            {{ form_widget(tag.lastFiliere) }}
                            {{ form_widget(tag.idCate) }}
                            {{ tag.refCadreEmploi.vars.data.lbCadrempl }}
                            <br/>
                            <span class="alerteConso">[1.2.1] = {{ tag.vars.value.totalInd121 }}</span>
                        </td>
                        <td id="r1221" style="text-align: center" data-col-group='row_total_tp,total_h'>{{ form_widget(tag.r1221) }}</td>
                        <td id="r1222" style="text-align: center" data-col-group='row_total_tp,total_f'>{{ form_widget(tag.r1222) }}</td>
                        <td class="filiTable" data-col-id='row_total_tp' data-col-group="lineTotr_tp_tpa">{{ total_row_tp }}</td>
                        <td id="r1223" style="text-align: center" data-col-group='row_total_tpa,total_h'>{{ form_widget(tag.r1223) }}</td>
                        <td id="r1224" style="text-align: center" data-col-group='row_total_tpa,total_f'>{{ form_widget(tag.r1224) }}</td>
                        <td id="r1225" style="text-align: center" data-col-group='row_total_tpa,total_h'>{{ form_widget(tag.r1225) }}</td>
                        <td id="r1226" style="text-align: center" data-col-group='row_total_tpa,total_f'>{{ form_widget(tag.r1226) }}</td>
                        <td id="r1227" style="text-align: center" data-col-group='row_total_tpa,total_h'>{{ form_widget(tag.r1227) }}</td>
                        <td id="r1228" style="text-align: center" data-col-group='row_total_tpa,total_f'>{{ form_widget(tag.r1228) }}</td>
                        <td class="filiTable" data-col-id='row_total_tpa' data-col-group="lineTotr_tp_tpa">{{ total_row_tpa }}</td>
                        <td class="filiTable" data-col-id='lineTotr_tp_tpa' >{{ total_row_tp + total_row_tpa }}</td>
                        <td class="filiTable" id="lineTot1" style="text-align: center" data-col-id='total_h' data-col-group='total_hf'>{{ total_row_h }}</td>
                        <td class="filiTable" id="lineTot2" style="text-align: center" data-col-id='total_f' data-col-group='total_hf'>{{ total_row_f }}</td>
                        <th class="filiTable" id="lineTot3"  style="text-align: center" data-col-id='total_hf'>{{ total_row_h + total_row_f }}</th>

                    </tr>

                {% endfor %}
                {% set total_ind = bilan_social_consolide.getIndPileForBy('ind122s',['refCadreEmploi','refFiliere','idFili'],idFili) %}
                {% set total_ind_h = total_ind.r1221 + total_ind.r1223 + total_ind.r1225 + total_ind.r1227 %}
                {% set total_ind_f = total_ind.r1222 + total_ind.r1224 + total_ind.r1226 + total_ind.r1228 %}
                {% set total_ind_tp = total_ind.r1221 + total_ind.r1222 %}
                {% set total_ind_tpa = total_ind.r1223 + total_ind.r1224 + total_ind.r1225 + total_ind.r1226 + total_ind.r1227 + total_ind.r1228 %}
                <tr id="totalFil" cdFili="{{ tagF.cdFili }}" class="filiTable row_totaux">
                    <td><b>Total {{ tagF.lbFili }} </b></td>
                    <td style="text-align: center" data-col-group='lineTotr_tp,lineTot_h'>{{ total_ind.r1221 }}</td>
                    <td style="text-align: center" data-col-group='lineTotr_tp,lineTot_f'>{{ total_ind.r1222 }}</td>
                    <td class="filiTable" id="total_tp" data-col-id='lineTotr_tp' data-col-group="lineTotr_tpf_tpaf">{{ total_ind_tp }}</td>
                    <td style="text-align: center" data-col-group="lineTotr_tpa,lineTot_h">{{ total_ind.r1223 }}</td>
                    <td style="text-align: center" data-col-group="lineTotr_tpa,lineTot_f">{{ total_ind.r1224 }}</td>
                    <td style="text-align: center" data-col-group="lineTotr_tpa,lineTot_h">{{ total_ind.r1225 }}</td>
                    <td style="text-align: center" data-col-group="lineTotr_tpa,lineTot_f">{{ total_ind.r1226 }}</td>
                    <td style="text-align: center" data-col-group="lineTotr_tpa,lineTot_h">{{ total_ind.r1227 }}</td>
                    <td style="text-align: center" data-col-group="lineTotr_tpa,lineTot_f">{{ total_ind.r1228 }}</td>
                    <td class="filiTable" data-col-id='lineTotr_tpa' data-col-group="lineTotr_tpf_tpaf">{{ total_ind_tpa }}</td>
                    <td class="filiTable" data-col-id='lineTotr_tpf_tpaf'>{{ total_ind_tp + total_ind_tpa }}</td>
                    <td class="filiTable" style="text-align: center" data-col-id='lineTot_h' data-col-group='lineTot_hf'>{{ total_ind_h }}</td>
                    <td class="filiTable" style="text-align: center" data-col-id='lineTot_f' data-col-group='lineTot_hf'>{{ total_ind_f }}</td>
                    <th class="filiTable" id="lineTot3" style="text-align: center"data-col-id='lineTot_hf'>{{ total_ind_h + total_ind_f }}</th>
                </tr>
            {% endif %}
        {% endfor %}

        {% set total_ind = bilan_social_consolide.getIndPileForBy('ind122s',['refCadreEmploi','refFiliere','cdFili'],['AOTM','H','HH'],{'exclude':true}) %}
        {% set total_ind_h = total_ind.r1221 + total_ind.r1223 + total_ind.r1225 + total_ind.r1227 %}
        {% set total_ind_f = total_ind.r1222 + total_ind.r1224 + total_ind.r1226 + total_ind.r1228 %}
        {% set total_ind_tp = total_ind.r1221 + total_ind.r1222 %}
        {% set total_ind_tpa = total_ind.r1223 + total_ind.r1224 + total_ind.r1225 + total_ind.r1226 + total_ind.r1227 + total_ind.r1228 %}
        <tr id="totalFilGlo" class="filiTable row_totaux">
            <td><b>TOUTES FILIERES</b></td>
            <td style="text-align: center" data-col-group='lineTotTF_tp,lineTotTF_h'>{{ total_ind.r1221 }}</td>
            <td style="text-align: center" data-col-group='lineTotTF_tp,lineTotTF_f'>{{ total_ind.r1222 }}</td>
            <td class="filiTable" id="total_tp" data-col-id='lineTotTF_tp' data-col-group="lineTotTF_tpf_tpaf">{{ total_ind_tp }}</td>
            <td style="text-align: center" data-col-group="lineTotTF_tpa,lineTotTF_h">{{ total_ind.r1223 }}</td>
            <td style="text-align: center" data-col-group="lineTotTF_tpa,lineTotTF_f">{{ total_ind.r1224 }}</td>
            <td style="text-align: center" data-col-group="lineTotTF_tpa,lineTotTF_h">{{ total_ind.r1225 }}</td>
            <td style="text-align: center" data-col-group="lineTotTF_tpa,lineTotTF_f">{{ total_ind.r1226 }}</td>
            <td style="text-align: center" data-col-group="lineTotTF_tpa,lineTotTF_h">{{ total_ind.r1227 }}</td>
            <td style="text-align: center" data-col-group="lineTotTF_tpa,lineTotTF_f">{{ total_ind.r1228 }}</td>
            <td class="filiTable" data-col-id='lineTotTF_tpa' data-col-group="lineTotTF_tpf_tpaf">{{ total_ind_tpa }}</td>
            <td class="filiTable" data-col-id='lineTotTF_tpf_tpaf'>{{ total_ind_tp + total_ind_tpa }}</td>
            <td class="filiTable" style="text-align: center" data-col-id='lineTotTF_h' data-col-group='lineTotTF_hf'>{{ total_ind_h }}</td>
            <td class="filiTable" style="text-align: center" data-col-id='lineTotTF_f' data-col-group='lineTotTF_hf'>{{ total_ind_f }}</td>
            <th class="filiTable" id="lineTot3" style="text-align: center"data-col-id='lineTotTF_hf'>{{ total_ind_h + total_ind_f }}</th>
        </tr>

        {% for tag in formEffectif122.ind122AotmsTemp %}
            {% set row_data = tag.vars.value %}
            {% set total_row_h = row_data.r1221 + row_data.r1223 + row_data.r1225 + row_data.r1227 %}
            {% set total_row_f = row_data.r1222 + row_data.r1224 + row_data.r1226 + row_data.r1228 %}
            {% set total_row_tp = row_data.r1221 + row_data.r1222 %}
            {% set total_row_tpa = row_data.r1223 + row_data.r1224 + row_data.r1225 + row_data.r1226 + row_data.r1227 + row_data.r1228 %}
            <tr cdFili="{{ tag.cdFili.vars.value }}"
                id="122trCE_{{tag.refCadreEmploi.vars.value}}"
                idTrFiliAotm="{{ tag.idFili.vars.value }}"
                idTrCate="{{ tag.idCate.vars.value }}">
                <td>
                    {{ form_widget(tag.refCadreEmploi) }}
                    {{ form_widget(tag.idFili) }}
                    {{ form_widget(tag.cdFili) }}
                    {{ form_widget(tag.lbFili) }}
                    {{ form_widget(tag.newFiliere) }}
                    {{ form_widget(tag.lastFiliere) }}
                    {{ form_widget(tag.idCate) }}
                    {{ tag.refCadreEmploi.vars.data.lbCadrempl }}
                    <br/>
                    <span class="alerteConso">[1.2.1] = {{ tag.vars.value.totalInd121 }}</span>
                </td>
                <td id="r1221" style="text-align: center" data-col-group='row_total_tp,total_h'>{{ form_widget(tag.r1221) }}</td>
                <td id="r1222" style="text-align: center" data-col-group='row_total_tp,total_f'>{{ form_widget(tag.r1222) }}</td>
                <td class="filiTable" data-col-id='row_total_tp' data-col-group="lineTotr_tp_tpa">{{ total_row_tp }}</td>
                <td id="r1223" style="text-align: center" data-col-group='row_total_tpa,total_h'>{{ form_widget(tag.r1223) }}</td>
                <td id="r1224" style="text-align: center" data-col-group='row_total_tpa,total_f'>{{ form_widget(tag.r1224) }}</td>
                <td id="r1225" style="text-align: center" data-col-group='row_total_tpa,total_h'>{{ form_widget(tag.r1225) }}</td>
                <td id="r1226" style="text-align: center" data-col-group='row_total_tpa,total_f'>{{ form_widget(tag.r1226) }}</td>
                <td id="r1227" style="text-align: center" data-col-group='row_total_tpa,total_h'>{{ form_widget(tag.r1227) }}</td>
                <td id="r1228" style="text-align: center" data-col-group='row_total_tpa,total_f'>{{ form_widget(tag.r1228) }}</td>
                <td class="filiTable" data-col-id='row_total_tpa' data-col-group="lineTotr_tp_tpa">{{ total_row_tpa }}</td>
                <td class="filiTable" data-col-id='lineTotr_tp_tpa'>{{ total_row_tp + total_row_tpa }}</td>
                <td class="filiTable" id="lineTot1" style="text-align: center" data-col-id='total_h' data-col-group='total_hf'>{{ total_row_h }}</td>
                <td class="filiTable" id="lineTot2" style="text-align: center" data-col-id='total_f' data-col-group='total_hf'>{{ total_row_f }}</td>
                <th class="filiTable" id="lineTot3" style="text-align: center"data-col-id='total_hf'>{{ total_row_h + total_row_f }}</th>

            </tr>

        {% endfor %}
        {% set total_ind = bilan_social_consolide.getIndPileForBy('ind122s',['refCadreEmploi','refFiliere','cdFili'],['H','HH'],{'exclude':true}) %}
        {% set total_ind_h = total_ind.r1221 + total_ind.r1223 + total_ind.r1225 + total_ind.r1227 %}
        {% set total_ind_f = total_ind.r1222 + total_ind.r1224 + total_ind.r1226 + total_ind.r1228 %}
        {% set total_ind_tp = total_ind.r1221 + total_ind.r1222 %}
        {% set total_ind_tpa = total_ind.r1223 + total_ind.r1224 + total_ind.r1225 + total_ind.r1226 + total_ind.r1227 + total_ind.r1228 %}
        <tr id="totalGlo" class="filiTable row_totaux">
            <td><b>TOTAL</b></td>
            <td style="text-align: center" data-col-group='row_totalT_tp,lineTotT_h'>{{ total_ind.r1221 }}</td>
            <td style="text-align: center" data-col-group='row_totalT_tp,lineTotT_f'>{{ total_ind.r1222 }}</td>
            <td class="filiTable" data-col-id='row_totalT_tp' data-col-group="lineTotT_tpf_tpaf">{{ total_ind_tp }}</td>
            <td style="text-align: center" data-col-group="row_totalT_tpa,lineTotT_h">{{ total_ind.r1223 }}</td>
            <td style="text-align: center" data-col-group="row_totalT_tpa,lineTotT_f">{{ total_ind.r1224 }}</td>
            <td style="text-align: center" data-col-group="row_totalT_tpa,lineTotT_h">{{ total_ind.r1225 }}</td>
            <td style="text-align: center" data-col-group="row_totalT_tpa,lineTotT_f">{{ total_ind.r1226 }}</td>
            <td style="text-align: center" data-col-group="row_totalT_tpa,lineTotT_h">{{ total_ind.r1227 }}</td>
            <td style="text-align: center" data-col-group="row_totalT_tpa,lineTotT_f">{{ total_ind.r1228 }}</td>
            <td class="filiTable" data-col-id='row_totalT_tpa' data-col-group="lineTotT_tpf_tpaf">{{ total_ind_tpa }}</td>
            <td class="filiTable" data-col-id='lineTotT_tpf_tpaf'>{{ total_ind_tp + total_ind_tpa }}</td>
            <td class="filiTable" style="text-align: center" data-col-id='lineTotT_h' data-col-group='lineTotT_hf'>{{ total_ind_h }}</td>
            <td class="filiTable" style="text-align: center" data-col-id='lineTotT_f' data-col-group='lineTotT_hf'>{{ total_ind_f }}</td>
            <th class="filiTable" id="lineTot3" style="text-align: center"data-col-id='lineTotT_hf'>{{ total_ind_h + total_ind_f }}</th>
        </tr>

        </tbody>
    </table>
    <br/>

    <input class="btn button-tableau pull-right" type="submit" value="Enregistrer et valider les contrôles de cohérence" name="valider" onclick="recordAuto = false;
                $('#progImg').show();" data-valide="1" />

    <img id="progImg" src="{{ asset("img/progress.gif") }}" style="display:none"/>

    {{ form_end(formEffectif122) }}

    <script type="text/javascript">


        $(document).ready(function ()
        {
            changeDetect = false;
            {% include 'stickyheader.txt' %}
            getBrowserSetSticky(ind122Table);

            {% if questionCollectiviteConsolide.q4 == true %}

            putSelectOnText122('ind122sTemp', 'refCadreEmploi');
            putSelectOnText122('ind122AotmsTemp', 'refCadreEmploi');
            $(document).change();
            //update122(true);

            {% endif %}
        });

        /**
         * Symfony met les entity many to one en select
         *       - Impossibilité de mettre en dsabled car à  l'envoi du form, no ne récup plus la valeur du référentiel
         * => Solution temporaire :
         *       - Cacher le select de l'entity référentiel
         *       - récupérer le text sélectionné par défaut du référentiel
         *       - ajouter ce texte à  la colonne du tab correpondant
         */
        function putSelectOnText122(listName, referentielName, withCompl, withNoLibelle) {
            var count = $('#bscForm122_' + listName + '_0_' + referentielName + ' option').length;

            for (var i = 0; i < count; i++) {
                $('#bscForm122_' + listName + '_' + i + '_' + referentielName + '').hide();

                if (withNoLibelle == undefined) {
                    var val = $('#bscForm122_' + listName + '_' + i + '_' + referentielName + ' option:selected').val();
                    var tex = $('#bscForm122_' + listName + '_' + i + '_' + referentielName + ' option:selected').text();
                    //$('#bscForm122_'+listName+'_'+i+'_'+referentielName+'').parent().append(tex);
                }

                if (withCompl != undefined) {
                    //$('#bscForm122_'+listName+'_'+i+'_'+referentielName+'').parent().append(' '
                    //   + '<span id="bscForm122_'+listName+'_'+i+'_'+referentielName+'_'+val+'"></span>');
                }
            }
        }

        function initLight122() {
            if (incoherenceList != undefined) {
                // Si le json js a été chargé  (via un eneregistrement) => light via le json
                for (var idx in incoherenceList) {
                    var incoh = incoherenceList[idx];
                    if (incoh.tableNum == '1.2.2') {
                        lightError(incoh.field, incoh.incoherence);
                    }
                }
            } else {
                // si premier acces à la page => light via le twig

                {% for tag in incoherenceList %}
                {% if tag.tableNum == '1.2.2' %}
                lightError('{{tag.field}}', {{tag.blIncoherence}});
                {% endif %}
                {% endfor %}

            }
        }

        /*
         * METHODES Tableau 1.2.2
         */
        {% if questionCollectiviteConsolide.q4 == true %}

        function toggleFiliere122(toggleObj, pidFili) {
            var css = toggleObj.getAttribute('class');

            {% if idFili != null and idFili != 0 %}
            // Sauvegarde auto
            if (currentTab != "")
                saveTab(currentTab);
            {% endif %}

            if (css == "buttonplus") {
                $('#ind122').load('{{ path('bilan_conso_effectif_ind122_edit') }}?idFili=' + pidFili, function () {
                    initLight122();
                    disabled();
                });

            } else {
                $('#ind122').load('{{ path('bilan_conso_effectif_ind122_edit') }}?idFili=' + 0, function () {
                    initLight122();
                    disabled();
                });

            }
        }

        // function changedR122(obj) {
        //     //update122(false);
        // }
        //
        // function update122(onInit) {
        //     var table122 = document.getElementById('ind122Table');
        //
        //     var rowLength122 = table122.rows.length;
        //     var idxRowInput = 0;
        //     var idxRowInputAotm = 0;
        //
        //     var mtTot1 = 0;
        //     var mtTot2 = 0;
        //     var mtTot3 = 0;
        //     var mtTot4 = 0;
        //     var mtTot5 = 0;
        //     var mtTot6 = 0;
        //     var mtTot7 = 0;
        //     var mtTot8 = 0;
        //
        //     var mtTot1Fil = 0;
        //     var mtTot2Fil = 0;
        //     var mtTot3Fil = 0;
        //     var mtTot4Fil = 0;
        //     var mtTot5Fil = 0;
        //     var mtTot6Fil = 0;
        //     var mtTot7Fil = 0;
        //     var mtTot8Fil = 0;
        //
        //     var mtTot1FilGlo = 0;
        //     var mtTot2FilGlo = 0;
        //     var mtTot3FilGlo = 0;
        //     var mtTot4FilGlo = 0;
        //     var mtTot5FilGlo = 0;
        //     var mtTot6FilGlo = 0;
        //     var mtTot7FilGlo = 0;
        //     var mtTot8FilGlo = 0;
        //
        //     var mtTot1HorsFil = 0;
        //     var mtTot2HorsFil = 0;
        //     var mtTot3HorsFil = 0;
        //     var mtTot4HorsFil = 0;
        //     var mtTot5HorsFil = 0;
        //     var mtTot6HorsFil = 0;
        //     var mtTot7HorsFil = 0;
        //     var mtTot8HorsFil = 0;
        //
        //     var mtTot1Glo = 0;
        //     var mtTot2Glo = 0;
        //     var mtTot3Glo = 0;
        //     var mtTot4Glo = 0;
        //     var mtTot5Glo = 0;
        //     var mtTot6Glo = 0;
        //     var mtTot7Glo = 0;
        //     var mtTot8Glo = 0;
        //
        //     for (var i = 0; i < rowLength122; i += 1) {
        //         var row = table122.rows[i];
        //
        //         if(row.getAttribute("entete") != undefined && row.getAttribute("entete") == "1") {
        //             continue;
        //         }
        //
        //         var lineAotm = false;
        //
        //         if(row.getAttribute("idTrFiliAotm") != undefined) {
        //             lineAotm = true;
        //         }
        //
        //         var cellLength = row.cells.length;
        //
        //         var lineTotalFil = false;
        //         var lineTotalFilGlo = false;
        //         var lineTotalGlo = false;
        //         var lineTot1 = 0;
        //         var lineTot2 = 0;
        //
        //         if (row.id.substring(0, 8) == "entetFil") {
        //             continue;
        //         }
        //
        //         if (row.id.substring(0, 18) == "totalHorsFil") {
        //             for (var y = 0; y < cellLength; y += 1) {
        //                 var cell = row.cells[y];
        //                 if (y == 1) {
        //                     mtTot1HorsFil = parseInt(cell.innerHTML);
        //                 } else if (y == 2) {
        //                     mtTot2HorsFil = parseInt(cell.innerHTML);
        //                 } else if (y == 3) {
        //                     mtTot3HorsFil = parseInt(cell.innerHTML);
        //                 } else if (y == 4) {
        //                     mtTot4HorsFil = parseInt(cell.innerHTML);
        //                 } else if (y == 5) {
        //                     mtTot5HorsFil = parseInt(cell.innerHTML);
        //                 } else if (y == 6) {
        //                     mtTot6HorsFil = parseInt(cell.innerHTML);
        //                 } else if (y == 7) {
        //                     mtTot7HorsFil = parseInt(cell.innerHTML);
        //                 } else if (y == 8) {
        //                     mtTot8HorsFil = parseInt(cell.innerHTML);
        //                 }
        //             }
        //         }
        //
        //         lineTot1 = 0;
        //         lineTot2 = 0;
        //
        //         if (row.id.substring(0, 11) == "totalFilGlo") {
        //             lineTotalFilGlo = true;
        //
        //             for (var y = 0; y < cellLength; y += 1) {
        //                 var cell = row.cells[y];
        //                 if (y == 1) {
        //                     cell.innerHTML = mtTot1FilGlo + mtTot1HorsFil;
        //                     lineTot1 += mtTot1FilGlo + mtTot1HorsFil;
        //                     mtTot1FilGlo = 0;
        //                 } else if (y == 2) {
        //                     cell.innerHTML = mtTot2FilGlo + mtTot2HorsFil;
        //                     lineTot2 += mtTot2FilGlo + mtTot2HorsFil;
        //                     mtTot2FilGlo = 0;
        //                 } else if (y == 3) {
        //                     cell.innerHTML = mtTot3FilGlo + mtTot3HorsFil;
        //                     lineTot1 += mtTot3FilGlo + mtTot3HorsFil;
        //                     mtTot3FilGlo = 0;
        //                 } else if (y == 4) {
        //                     cell.innerHTML = mtTot4FilGlo + mtTot4HorsFil;
        //                     lineTot2 += mtTot4FilGlo + mtTot4HorsFil;
        //                     mtTot4FilGlo = 0;
        //                 } else if (y == 5) {
        //                     cell.innerHTML = mtTot5FilGlo + mtTot5HorsFil;
        //                     lineTot1 += mtTot5FilGlo + mtTot5HorsFil;
        //                     mtTot5FilGlo = 0;
        //                 } else if (y == 6) {
        //                     cell.innerHTML = mtTot6FilGlo + mtTot6HorsFil;
        //                     lineTot2 += mtTot6FilGlo + mtTot6HorsFil;
        //                     mtTot6FilGlo = 0;
        //                 } else if (y == 7) {
        //                     cell.innerHTML = mtTot7FilGlo + mtTot7HorsFil;
        //                     lineTot1 += mtTot7FilGlo + mtTot7HorsFil;
        //                     mtTot7FilGlo = 0;
        //                 } else if (y == 8) {
        //                     cell.innerHTML = mtTot8FilGlo + mtTot8HorsFil;
        //                     lineTot2 += mtTot8FilGlo + mtTot8HorsFil;
        //                     mtTot8FilGlo = 0;
        //                 } else if (y == 9) {
        //                     cell.innerHTML = lineTot1;
        //                 } else if (y == 10) {
        //                     cell.innerHTML = lineTot2;
        //                 } else if (y == 11) {
        //                     cell.innerHTML = lineTot1 + lineTot2;
        //                 }
        //             }
        //         } else if (row.id.substring(0, 8) == "totalFil") {
        //             lineTotalFil = true;
        //
        //             for (var y = 0; y < cellLength; y += 1) {
        //                 var cell = row.cells[y];
        //                 if (y == 1) {
        //                     cell.innerHTML = mtTot1Fil;
        //                     lineTot1 += mtTot1Fil;
        //                     mtTot1Fil = 0;
        //                 } else if (y == 2) {
        //                     cell.innerHTML = mtTot2Fil;
        //                     lineTot2 += mtTot2Fil;
        //                     mtTot2Fil = 0;
        //                 } else if (y == 3) {
        //                     cell.innerHTML = mtTot3Fil;
        //                     lineTot1 += mtTot3Fil;
        //                     mtTot3Fil = 0;
        //                 } else if (y == 4) {
        //                     cell.innerHTML = mtTot4Fil;
        //                     lineTot2 += mtTot4Fil;
        //                     mtTot4Fil = 0;
        //                 } else if (y == 5) {
        //                     cell.innerHTML = mtTot5Fil;
        //                     lineTot1 += mtTot5Fil;
        //                     mtTot5Fil = 0;
        //                 } else if (y == 6) {
        //                     cell.innerHTML = mtTot6Fil;
        //                     lineTot2 += mtTot6Fil;
        //                     mtTot6Fil = 0;
        //                 } else if (y == 7) {
        //                     cell.innerHTML = mtTot7Fil;
        //                     lineTot1 += mtTot7Fil;
        //                     mtTot7Fil = 0;
        //                 } else if (y == 8) {
        //                     cell.innerHTML = mtTot8Fil;
        //                     lineTot2 += mtTot8Fil;
        //                     mtTot8Fil = 0;
        //                 } else if (y == 9) {
        //                     cell.innerHTML = lineTot1;
        //                 } else if (y == 10) {
        //                     cell.innerHTML = lineTot2;
        //                 } else if (y == 11) {
        //                     cell.innerHTML = lineTot1 + lineTot2;
        //                 }
        //             }
        //         }
        //
        //         lineTot1 = 0;
        //         lineTot2 = 0;
        //
        //         if (row.id.substring(0, 8) == "totalGlo") {
        //             lineTotalGlo = true;
        //
        //             for (var y = 0; y < cellLength; y += 1) {
        //                 var cell = row.cells[y];
        //                 if (y == 1) {
        //                     cell.innerHTML = mtTot1Glo + mtTot1HorsFil;
        //                     lineTot1 += mtTot1Glo + mtTot1HorsFil;
        //                     mtTot1Glo = 0;
        //                 } else if (y == 2) {
        //                     cell.innerHTML = mtTot2Glo + mtTot2HorsFil;
        //                     lineTot2 += mtTot2Glo + mtTot2HorsFil;
        //                     mtTot2Glo = 0;
        //                 } else if (y == 3) {
        //                     cell.innerHTML = mtTot3Glo + mtTot3HorsFil;
        //                     lineTot1 += mtTot3Glo + mtTot3HorsFil;
        //                     mtTot3Glo = 0;
        //                 } else if (y == 4) {
        //                     cell.innerHTML = mtTot4Glo + mtTot4HorsFil;
        //                     lineTot2 += mtTot4Glo + mtTot4HorsFil;
        //                     mtTot4Glo = 0;
        //                 } else if (y == 5) {
        //                     cell.innerHTML = mtTot5Glo + mtTot5HorsFil;
        //                     lineTot1 += mtTot5Glo + mtTot5HorsFil;
        //                     mtTot5Glo = 0;
        //                 } else if (y == 6) {
        //                     cell.innerHTML = mtTot6Glo + mtTot6HorsFil;
        //                     lineTot2 += mtTot6Glo + mtTot6HorsFil;
        //                     mtTot6Glo = 0;
        //                 } else if (y == 7) {
        //                     cell.innerHTML = mtTot7Glo + mtTot7HorsFil;
        //                     lineTot1 += mtTot7Glo + mtTot7HorsFil;
        //                     mtTot7Glo = 0;
        //                 } else if (y == 8) {
        //                     cell.innerHTML = mtTot8Glo + mtTot8HorsFil;
        //                     lineTot2 += mtTot8Glo + mtTot8HorsFil;
        //                     mtTot8Glo = 0;
        //                 } else if (y == 9) {
        //                     cell.innerHTML = lineTot1;
        //                 } else if (y == 10) {
        //                     cell.innerHTML = lineTot2;
        //                 } else if (y == 11) {
        //                     cell.innerHTML = lineTot1 + lineTot2;
        //                 }
        //             }
        //         }
        //
        //         lineTot1 = 0;
        //         lineTot2 = 0;
        //
        //         for (var y = 0; y < cellLength; y += 1) {
        //             var cell = row.cells[y];
        //             var cellValue;
        //
        //             if (cell.id.substring(0, 5) == "r1221") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1221').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot1 += cellValue;
        //                         mtTot1Fil += cellValue;
        //                         mtTot1FilGlo += cellValue;
        //                     }
        //                     mtTot1Glo += cellValue;
        //                     lineTot1 += cellValue;
        //                 }
        //                 //if ($('#bscForm122_ind122sTemp_' + idxRowInput + '_r1221').val() != "") {
        //                     //mtTot1 += parseInt($('#bscForm122_ind122sTemp_' + idxRowInput + '_r1221').val());
        //                     //mtTot1Fil += parseInt($('#bscForm122_ind122sTemp_' + idxRowInput + '_r1221').val());
        //                     //mtTot1FilGlo += parseInt($('#bscForm122_ind122sTemp_' + idxRowInput + '_r1221').val());
        //                     //lineTot1 += parseInt($('#bscForm122_ind122sTemp_' + idxRowInput + '_r1221').val());
        //                 //}
        //             } else if (cell.id.substring(0, 5) == "r1222") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1222').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot2 += cellValue;
        //                         mtTot2Fil += cellValue;
        //                         mtTot2FilGlo += cellValue;
        //                     }
        //                     mtTot2Glo += cellValue;
        //                     lineTot2 += cellValue;
        //                 }
        //             } else if (cell.id.substring(0, 5) == "r1223") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1223').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot3 += cellValue;
        //                         mtTot3Fil += cellValue;
        //                         mtTot3FilGlo += cellValue;
        //                     }
        //                     mtTot3Glo += cellValue;
        //                     lineTot1 += cellValue;
        //                 }
        //             } else if (cell.id.substring(0, 5) == "r1224") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1224').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot4 += cellValue;
        //                         mtTot4Fil += cellValue;
        //                         mtTot4FilGlo += cellValue;
        //                     }
        //                     mtTot4Glo += cellValue;
        //                     lineTot2 += cellValue;
        //                 }
        //             } else if (cell.id.substring(0, 5) == "r1225") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1225').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot5 += cellValue;
        //                         mtTot5Fil += cellValue;
        //                         mtTot5FilGlo += cellValue;
        //                     }
        //                     mtTot5Glo += cellValue;
        //                     lineTot1 += cellValue;
        //                 }
        //             } else if (cell.id.substring(0, 5) == "r1226") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1226').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot6 += cellValue;
        //                         mtTot6Fil += cellValue;
        //                         mtTot6FilGlo += cellValue;
        //                     }
        //                     mtTot6Glo += cellValue;
        //                     lineTot2 += cellValue;
        //                 }
        //             } else if (cell.id.substring(0, 5) == "r1227") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1227').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot7 += cellValue;
        //                         mtTot7Fil += cellValue;
        //                         mtTot7FilGlo += cellValue;
        //                     }
        //                     mtTot7Glo += cellValue;
        //                     lineTot1 += cellValue;
        //                 }
        //             } else if (cell.id.substring(0, 5) == "r1228") {
        //                 cellValue = $('#bscForm122_ind122' + (lineAotm ? 'Aotm' : '') + 'sTemp_' + (lineAotm ? idxRowInputAotm : idxRowInput) + '_r1228').val();
        //                 if (cellValue != "") {
        //                     cellValue = parseInt(cellValue);
        //                     if(!lineAotm) {
        //                         mtTot8 += cellValue;
        //                         mtTot8Fil += cellValue;
        //                         mtTot8FilGlo += cellValue;
        //                     }
        //                     mtTot8Glo += cellValue;
        //                     lineTot2 += cellValue;
        //                 }
        //             } else if (cell.id.substring(0, 8) == "lineTot1") {
        //                 cell.innerHTML = lineTot1;
        //             } else if (cell.id.substring(0, 8) == "lineTot2") {
        //                 cell.innerHTML = lineTot2;
        //             } else if (cell.id.substring(0, 8) == "lineTot3") {
        //                 cell.innerHTML = lineTot1 + lineTot2;
        //             }
        //
        //         }
        //
        //         if (!lineTotalFil && !lineTotalFilGlo && !lineTotalGlo) idxRowInput++;
        //         if (lineAotm) idxRowInputAotm++;
        //     }// end for line
        //
        // }

        {% endif %}


        /*
         * METHODE AJAX SUBMIT
         */
        $(function () {
            // Enregistrement en ajax
            $('form').on('submit', function (e) {
                var $this = $(this).closest('div');
                var btn = $(this).find("input[type=submit]:focus");
                var value_valide = $(btn).data('valide');
                $('#bscForm122_valide').val(value_valide);
                // Submit en ajax pour le fonctionnement d'appel par onglet
                e.preventDefault();

                $.ajax({
                    type: 'post',
                    url: '{{ path('bilan_conso_effectif_ind122_edit') }}?idFili={{idFili}}',
                    data: $('form').serialize(),
                    success: function (responsejson) {
                        if (responsejson.data == 1) {
                            if (recordAuto) {
                                $('#progImg').hide();
                                $('#messageJS').html("Enregistrement automatique réussi");

                                messageJS.dialog("open");
                                setIncoherenceTable(responsejson);

                            } else {
                                $('#ind122').load('{{ path('bilan_conso_effectif_ind122_edit') }}', function () {
                                    $('#progImg').hide();
                                    $('#messageJS').html("Enregistrement réussi");

                                    messageJS.dialog("open");
                                    setIncoherenceTable(responsejson);

                                    var next = $($this).next('.panel-heading');
                                    if(next.length == 0) {
                                        window.location.href = '{{ path('bilan_conso_mouv_edit') }}';
                                    }
                                });

                            }
                        } else if (responsejson.data == "-3") {
                            $('#progImg').hide();
                            $('#messageJS').html("{{'erreur.unique.violation'|trans}}");
                            messageJS.dialog("open");
                        } else {
                            $('#progImg').hide();
                            $('#messageJS').html("Une erreur s'est produite dans l'enregistrement 1");
                            messageJS.dialog("open");
                        }


                    },
                    error: function (xhr, status, error) {
                        //alert(xhr);
                        $('#progImg').hide();
                        $('#messageJS').html("Une erreur s'est produite dans l'enregistrement 2 ");
                        messageJS.dialog("open");
                    }

                });

            });

        });

    </script>
{% endif %}
